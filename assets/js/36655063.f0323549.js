"use strict";(globalThis.webpackChunkfitnexa_docs=globalThis.webpackChunkfitnexa_docs||[]).push([[1373],{1661(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"ARCHITECTURE_REVIEW","title":"FitNexa Architecture Review","description":"This document summarizes an architecture review of the FitNexa monorepo and highlights problems and recommendations.","source":"@site/docs/ARCHITECTURE_REVIEW.md","sourceDirName":".","slug":"/ARCHITECTURE_REVIEW","permalink":"/fitnexa-docs/docs/ARCHITECTURE_REVIEW","draft":false,"unlisted":false,"editUrl":"https://github.com/FitNexa/fitnexa-platform/tree/main/fitnexa-docs/docs/ARCHITECTURE_REVIEW.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","next":{"title":"@fitnexa/shared Package","permalink":"/fitnexa-docs/docs/SHARED_PACKAGE"}}');var r=i(4848),d=i(8453);const t={},o="FitNexa Architecture Review",c={},l=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. Issues Found",id:"2-issues-found",level:2},{value:"2.1 <strong>AuthContext drops <code>gymId</code> on register (bug)</strong>",id:"21-authcontext-drops-gymid-on-register-bug",level:3},{value:"2.2 <strong>Duplicate / dead API client in mobile</strong>",id:"22-duplicate--dead-api-client-in-mobile",level:3},{value:"2.3 <strong>@fitnexa/shared main entry is backend-heavy</strong>",id:"23-fitnexashared-main-entry-is-backend-heavy",level:3},{value:"2.4 <strong>Config-manager is Node-only but lives next to environment</strong>",id:"24-config-manager-is-node-only-but-lives-next-to-environment",level:3},{value:"2.5 <strong>Shared auth service interface vs mobile implementation</strong>",id:"25-shared-auth-service-interface-vs-mobile-implementation",level:3},{value:"2.6 <strong>Bootstrap and config load order (mobile)</strong>",id:"26-bootstrap-and-config-load-order-mobile",level:3},{value:"3. What\u2019s Working Well",id:"3-whats-working-well",level:2},{value:"4. Recommendations Summary (implemented)",id:"4-recommendations-summary-implemented",level:2},{value:"5. Dependency Direction (validated)",id:"5-dependency-direction-validated",level:2},{value:"6. Backend TypeScript resolution for <code>@fitnexa/shared/server</code>",id:"6-backend-typescript-resolution-for-fitnexasharedserver",level:2}];function a(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"fitnexa-architecture-review",children:"FitNexa Architecture Review"})}),"\n",(0,r.jsx)(n.p,{children:"This document summarizes an architecture review of the FitNexa monorepo and highlights problems and recommendations."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fitnexa-shared"}),": Types, DTOs, config (environment + config-manager), API client, services, middleware, bootstrap."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fitnexa-mobile"}),": Expo/React Native app; uses shared ",(0,r.jsx)(n.strong,{children:"types"}),", ",(0,r.jsx)(n.strong,{children:"config (environment only)"}),", ",(0,r.jsx)(n.strong,{children:"api"})," (for configuration), ",(0,r.jsx)(n.strong,{children:"lib/utils"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fitnexa-backend"}),": Gateway + microservices; use shared ",(0,r.jsx)(n.strong,{children:"ConfigManager"}),", ",(0,r.jsx)(n.strong,{children:"middleware"}),", ",(0,r.jsx)(n.strong,{children:"bootstrap"}),", ",(0,r.jsx)(n.strong,{children:"types"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"2-issues-found",children:"2. Issues Found"}),"\n",(0,r.jsxs)(n.h3,{id:"21-authcontext-drops-gymid-on-register-bug",children:["2.1 ",(0,r.jsxs)(n.strong,{children:["AuthContext drops ",(0,r.jsx)(n.code,{children:"gymId"})," on register (bug)"]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where:"})," ",(0,r.jsx)(n.code,{children:"fitnexa-mobile/src/context/AuthContext.tsx"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What:"})," ",(0,r.jsx)(n.code,{children:"register(email, password, name, gymId?)"})," receives ",(0,r.jsx)(n.code,{children:"gymId"})," but calls ",(0,r.jsx)(n.code,{children:"service.register(email, password, name)"})," and never passes ",(0,r.jsx)(n.code,{children:"gymId"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Registration from the app never sends the selected gym to the backend, even though the UI and ",(0,r.jsx)(n.code,{children:"authService"})," support it."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Call ",(0,r.jsx)(n.code,{children:"service.register(email, password, name, gymId)"})," in ",(0,r.jsx)(n.code,{children:"AuthContext.register"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"22-duplicate--dead-api-client-in-mobile",children:["2.2 ",(0,r.jsx)(n.strong,{children:"Duplicate / dead API client in mobile"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where:"})," ",(0,r.jsx)(n.code,{children:"fitnexa-mobile/src/services/apiClient.ts"})," vs ",(0,r.jsx)(n.code,{children:"fitnexa-mobile/src/services/api.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"api.ts"})," defines a full ",(0,r.jsx)(n.code,{children:"ApiClient"})," (auth headers, token refresh, 401 handling) and exports ",(0,r.jsx)(n.code,{children:"identityApi"}),", ",(0,r.jsx)(n.code,{children:"gymApi"}),", etc. All app code uses these."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"apiClient.ts"})," configures and re-exports ",(0,r.jsx)(n.code,{children:"@fitnexa/shared"}),"\u2019s ",(0,r.jsx)(n.code,{children:"ApiClient"})," (no auth/refresh). Nothing in the app imports from ",(0,r.jsx)(n.code,{children:"apiClient.ts"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Dead code, confusion (e.g. comments in ",(0,r.jsx)(n.code,{children:"nutritionService.ts"})," referring to \u201capiClient\u201d and \u201cupload\u201d on the wrong client), and two parallel HTTP abstractions."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Remove ",(0,r.jsx)(n.code,{children:"apiClient.ts"})," and any references, or clearly document that only ",(0,r.jsx)(n.code,{children:"api.ts"})," is used and that shared ",(0,r.jsx)(n.code,{children:"ApiClient"})," is for non-mobile use. Prefer a single client (e.g. keep ",(0,r.jsx)(n.code,{children:"api.ts"})," and stop re-exporting shared ",(0,r.jsx)(n.code,{children:"ApiClient"})," in mobile)."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"23-fitnexashared-main-entry-is-backend-heavy",children:["2.3 ",(0,r.jsx)(n.strong,{children:"@fitnexa/shared main entry is backend-heavy"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where:"})," ",(0,r.jsx)(n.code,{children:"fitnexa-shared/src/index.ts"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What:"})," The default package entry exports:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"config-manager"})," (Node: ",(0,r.jsx)(n.code,{children:"dotenv"}),", ",(0,r.jsx)(n.code,{children:"path"}),", ",(0,r.jsx)(n.code,{children:"process.exit"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bootstrap"})," (Express, ",(0,r.jsx)(n.code,{children:"ConfigManager"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"middleware"})," (Express)"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"test/test-utils"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"utils/auth"})," (likely JWT/Node)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Any consumer that does ",(0,r.jsx)(n.code,{children:"import \u2026 from '@fitnexa/shared'"})," (barrel) pulls in Node/Express. Mobile and admin currently use ",(0,r.jsx)(n.strong,{children:"subpaths only"})," (",(0,r.jsx)(n.code,{children:"@fitnexa/shared/types"}),", ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/config"}),", etc.), so they are safe today, but the default entry is fragile and easy to misuse."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prefer not exporting backend-only modules from the main entry."}),"\n",(0,r.jsxs)(n.li,{children:["Add a dedicated server entry, e.g. ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/server"})," or ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/node"}),", that exports ",(0,r.jsx)(n.code,{children:"ConfigManager"}),", ",(0,r.jsx)(n.code,{children:"createBaseService"}),", middleware, and other Node-only code."]}),"\n",(0,r.jsxs)(n.li,{children:["Keep the default entry (and/or ",(0,r.jsx)(n.code,{children:"index.browser.ts"}),") for types, environment config, and platform-agnostic API client only."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"24-config-manager-is-node-only-but-lives-next-to-environment",children:["2.4 ",(0,r.jsx)(n.strong,{children:"Config-manager is Node-only but lives next to environment"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where:"})," ",(0,r.jsx)(n.code,{children:"fitnexa-shared/src/config/config-manager.ts"})," and ",(0,r.jsx)(n.code,{children:"environment.ts"})," in the same folder."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What:"})," ",(0,r.jsx)(n.code,{children:"config-manager"})," uses ",(0,r.jsx)(n.code,{children:"dotenv"}),", ",(0,r.jsx)(n.code,{children:"path"}),", ",(0,r.jsx)(n.code,{children:"process.env"}),", ",(0,r.jsx)(n.code,{children:"process.exit"}),", and Zod. It is only appropriate for Node services. ",(0,r.jsx)(n.code,{children:"environment.ts"})," is platform-agnostic (in-memory config)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Low if no client ever imports ",(0,r.jsx)(n.code,{children:"config-manager"})," (and they shouldn\u2019t). The package already exposes only ",(0,r.jsx)(n.code,{children:"./config"})," \u2192 ",(0,r.jsx)(n.code,{children:"environment.js"})," in ",(0,r.jsx)(n.code,{children:"exports"}),", so mobile/admin using ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/config"})," are fine. Risk is from barrel imports (see 2.3)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Move ",(0,r.jsx)(n.code,{children:"config-manager"})," (and any other Node-only config) under a ",(0,r.jsx)(n.code,{children:"server/"})," or ",(0,r.jsx)(n.code,{children:"node/"})," subpath and export it only from the server entry. Keep ",(0,r.jsx)(n.code,{children:"config/"})," for environment and other shared config."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"25-shared-auth-service-interface-vs-mobile-implementation",children:["2.5 ",(0,r.jsx)(n.strong,{children:"Shared auth service interface vs mobile implementation"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where:"})," ",(0,r.jsx)(n.code,{children:"fitnexa-shared/src/services/authService.ts"})," defines ",(0,r.jsx)(n.code,{children:"AuthServiceInterface"})," and uses shared ",(0,r.jsx)(n.code,{children:"ApiClient"})," with endpoints like ",(0,r.jsx)(n.code,{children:"/api/identity/login"}),". Mobile has its own ",(0,r.jsx)(n.code,{children:"authService.ts"})," using ",(0,r.jsx)(n.code,{children:"identityApi"})," (from ",(0,r.jsx)(n.code,{children:"api.ts"}),") and paths like ",(0,r.jsx)(n.code,{children:"/login"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What:"})," Two different auth abstractions: shared (generic, different base path) and mobile (concrete, gateway paths). Mobile does not implement the shared interface; it uses its own ",(0,r.jsx)(n.code,{children:"authService"})," and ",(0,r.jsx)(n.code,{children:"IAuthService"})," in ",(0,r.jsx)(n.code,{children:"types/services.ts"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Slight duplication and risk of drift (e.g. shared has no ",(0,r.jsx)(n.code,{children:"gymId"})," in register). Not critical if mobile is the only client and backend contract is stable."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fix:"})," Either (a) make mobile\u2019s auth service implement the shared interface and align endpoints, or (b) treat shared auth as \u201creference/backend-only\u201d and keep mobile\u2019s implementation as the source of truth for the app, and document that."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"26-bootstrap-and-config-load-order-mobile",children:["2.6 ",(0,r.jsx)(n.strong,{children:"Bootstrap and config load order (mobile)"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where:"})," ",(0,r.jsx)(n.code,{children:"fitnexa-mobile/src/config/environment.ts"})," does ",(0,r.jsx)(n.code,{children:"import './bootstrap'"})," then ",(0,r.jsx)(n.code,{children:"getApiUrls()"})," / ",(0,r.jsx)(n.code,{children:"getEnvironment()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What:"})," ",(0,r.jsx)(n.code,{children:"API_URLS"})," and ",(0,r.jsx)(n.code,{children:"ENVIRONMENT"})," are computed at first import of ",(0,r.jsx)(n.code,{children:"config"})," (or ",(0,r.jsx)(n.code,{children:"environment"}),"). Bootstrap (Expo Constants \u2192 ",(0,r.jsx)(n.code,{children:"configureEnvironment"}),") must run before any code uses ",(0,r.jsx)(n.code,{children:"getApiUrls()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Impact:"})," Correct as long as the first touch of config is via ",(0,r.jsx)(n.code,{children:"config/index"})," or ",(0,r.jsx)(n.code,{children:"config/environment"}),". That holds today because ",(0,r.jsx)(n.code,{children:"api.ts"})," imports ",(0,r.jsx)(n.code,{children:"../config"}),", and any use of ",(0,r.jsx)(n.code,{children:"identityApi"}),"/",(0,r.jsx)(n.code,{children:"gymApi"})," loads ",(0,r.jsx)(n.code,{children:"api.ts"})," \u2192 config \u2192 bootstrap."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Recommendation:"})," Document that \u201cconfig must be imported before any service that uses API_URLS\u201d and consider a single app entry (e.g. ",(0,r.jsx)(n.code,{children:"App.tsx"})," or ",(0,r.jsx)(n.code,{children:"index.js"}),") that imports ",(0,r.jsx)(n.code,{children:"./src/config"})," first so the order is explicit and robust."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"3-whats-working-well",children:"3. What\u2019s Working Well"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subpath exports:"})," Mobile and backend use ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/types"}),", ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/config"}),", ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/api"}),", etc., which avoids pulling the whole barrel and keeps client bundles safe from Node-only code."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Environment vs config-manager:"})," ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/config"})," points to ",(0,r.jsx)(n.code,{children:"environment.js"})," only; gateway URL build and API paths match backend routes (",(0,r.jsx)(n.code,{children:"/auth"}),", ",(0,r.jsx)(n.code,{children:"/gym"}),", etc.)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"DTOs and types:"})," Shared types (User, CheckIn, Gym, etc.) are used consistently by mobile and backend."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"AuthContext DIP:"})," Optional ",(0,r.jsx)(n.code,{children:"authService"})," injection in ",(0,r.jsx)(n.code,{children:"AuthProvider"})," is good for testing and swapping implementations."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Single mobile API surface:"})," All app code goes through ",(0,r.jsx)(n.code,{children:"api.ts"})," (",(0,r.jsx)(n.code,{children:"identityApi"}),", ",(0,r.jsx)(n.code,{children:"gymApi"}),", \u2026) with a single place for tokens and refresh logic."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"4-recommendations-summary-implemented",children:"4. Recommendations Summary (implemented)"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Priority"}),(0,r.jsx)(n.th,{children:"Action"}),(0,r.jsx)(n.th,{children:"Status"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"High"}),(0,r.jsxs)(n.td,{children:["Fix ",(0,r.jsx)(n.strong,{children:"AuthContext"}),": pass ",(0,r.jsx)(n.code,{children:"gymId"})," to ",(0,r.jsx)(n.code,{children:"service.register(email, password, name, gymId)"}),"."]}),(0,r.jsx)(n.td,{children:"Done"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Medium"}),(0,r.jsxs)(n.td,{children:["Remove or repurpose ",(0,r.jsx)(n.strong,{children:"apiClient.ts"})," in mobile; use a single API client (keep ",(0,r.jsx)(n.code,{children:"api.ts"}),") and update README/comments."]}),(0,r.jsxs)(n.td,{children:["Done: removed ",(0,r.jsx)(n.code,{children:"apiClient.ts"}),", updated README and nutritionService comment."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Medium"}),(0,r.jsxs)(n.td,{children:["Split ",(0,r.jsx)(n.strong,{children:"@fitnexa/shared"})," default entry: move ConfigManager, bootstrap, middleware to e.g. ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/server"})," and keep default for types + environment + platform-agnostic API client."]}),(0,r.jsxs)(n.td,{children:["Done: added ",(0,r.jsx)(n.code,{children:"./server"})," entry; backend imports from ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/server"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Low"}),(0,r.jsxs)(n.td,{children:["Document ",(0,r.jsx)(n.strong,{children:"config load order"})," in mobile (bootstrap before any API usage) and optionally import config at app entry."]}),(0,r.jsxs)(n.td,{children:["Done: ",(0,r.jsx)(n.code,{children:"App.tsx"})," imports config first; ",(0,r.jsx)(n.code,{children:"src/config/README.md"})," documents load order."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Low"}),(0,r.jsxs)(n.td,{children:["Clarify ",(0,r.jsx)(n.strong,{children:"shared vs mobile auth"}),": either implement shared interface in mobile or document that shared auth is reference-only."]}),(0,r.jsxs)(n.td,{children:["Done: comment in shared ",(0,r.jsx)(n.code,{children:"authService.ts"}),"."]})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"5-dependency-direction-validated",children:"5. Dependency Direction (validated)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fitnexa-shared"})," has no dependency on mobile or backend; it is the shared kernel. \u2713"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fitnexa-mobile"})," depends only on shared (types, config, api, lib/utils) and does not import backend-only exports when using subpaths. \u2713"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fitnexa-backend"})," services depend on shared (ConfigManager, types, middleware, etc.). \u2713"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"No circular dependencies were identified between packages."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"6-backend-typescript-resolution-for-fitnexasharedserver",children:["6. Backend TypeScript resolution for ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/server"})]}),"\n",(0,r.jsxs)(n.p,{children:["All backend services use a ",(0,r.jsx)(n.strong,{children:"path mapping"})," in ",(0,r.jsx)(n.code,{children:"tsconfig.json"})," so that ",(0,r.jsx)(n.code,{children:"@fitnexa/shared/server"})," resolves to the built shared package. Under ",(0,r.jsx)(n.code,{children:"compilerOptions"})," they have:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'"baseUrl": "."'})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"paths": { "@fitnexa/shared/server": ["../../../fitnexa-shared/dist/server/index"] }'}),(0,r.jsx)(n.br,{}),"\n","(services that already had ",(0,r.jsx)(n.code,{children:"paths"})," also include this entry)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Applied in: ",(0,r.jsx)(n.strong,{children:"identity-service"}),", ",(0,r.jsx)(n.strong,{children:"gateway"}),", ",(0,r.jsx)(n.strong,{children:"gym-service"}),", ",(0,r.jsx)(n.strong,{children:"wizard-service"}),", ",(0,r.jsx)(n.strong,{children:"content-service"}),", ",(0,r.jsx)(n.strong,{children:"nutrition-service"}),", ",(0,r.jsx)(n.strong,{children:"squad-service"}),", ",(0,r.jsx)(n.strong,{children:"logging-service"}),", ",(0,r.jsx)(n.strong,{children:"messaging-service"}),".",(0,r.jsx)(n.br,{}),"\n","Ensure ",(0,r.jsx)(n.code,{children:"fitnexa-shared"})," is built (",(0,r.jsx)(n.code,{children:"npm run build"})," in ",(0,r.jsx)(n.code,{children:"fitnexa-shared"}),") before building any service."]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>t,x:()=>o});var s=i(6540);const r={},d=s.createContext(r);function t(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);